/*!
 * 本地存储框架cStorgae v1.0
 * 开发日期: 13-11-5
 *
 * 依赖:无
 * 全局变量：cStorage, cst;
 */
(function(f){var b=0,g=30,l=function(){},c=f.cst=f.cStorage={VERSION:"1.0-beta1",type:"none",support:true,use:null,info:l,destroy:l},d=f.localStorage,i="[object Storage]",h,e,j=f.document,k=f.JSON||{},a;b=Math.min(b,7);g=Math.min(g,60);if(typeof d==="object"){if(typeof d.toString==="function"){h=d.toString()}if(h!==i&&d.constructor){h=d.constructor.toString()}}if(h===i){c.type="storage"}else{if(j.documentElement.addBehavior){c.type="userData"}}e=c._tool={dA:b,mA:g,coreToString:Object.prototype.toString,storage:f.localStorage,initObj:function(m){delete m._data;delete m._info;m.set=m.remove=m.clear=function(){return this};m.get=m.count=function(){};return m},error:function(m){throw Error(m)},getStorageName:function(m){if(typeof m!=="string"||!/^\w+$/g.test(m)||m.length<8){this.error("storageId\u81F3\u5C11\u75318\u4F4D\u5B57\u6BCD\uFF0C\u6570\u5B57\u548C\u4E0B\u5212\u7EBF\u7EC4\u6210")}return"cs_"+m+"_"},filterName:function(m){if(typeof m!=="string"){this.error("\u53C2\u6570name\u5E94\u8BE5\u4E3A\u5B57\u7B26\u4E32")}},getExpiresDate:function(n){var m=new Date();m.setTime(m.getTime()+n*86400000);return m.toUTCString()},random:function(){return Math.random().toString().substring(2,10)-0},fixMaxAge:function(n){var m=typeof n;if(m==="number"){n=n<0?0:n;return Math.min(parseInt(n,10),this.mA)}},useManager:function(n,m){var p,o;o=this.mA;this.mA=360;p=c.use(n,m);this.mA=o;return p},stringifyJSON:k.stringify,parseJSON:k.parse};c._publicMethods={set:function(n,r){var s,q,o,m,t;e.updateData(this);q=this._data;if(typeof q==="object"){o=e.stringifyJSON;if(e.coreToString.call(n)==="[object Object]"){for(s in n){if(n.hasOwnProperty(s)){m=n[s];if(m===undefined){if(q[s]!==undefined){t=true;delete q[s]}}else{m=o(m);if(q[s]!==m){t=true;q[s]=m}}}}}else{e.filterName(n);if(r===undefined){if(r!==q[n]){t=true;delete q[n]}}else{r=o(r);if(r!==q[n]){t=true;q[n]=r}}}if(t){e.setData(this)}}return this},get:function(m){var o,n;e.updateData(this);e.filterName(m);o=this._data;if(typeof o==="object"){n=o[m];if(n!==undefined){return e.parseJSON(n)}}},count:function(){var o,n,m;e.updateData(this);n=this._data;if(typeof n==="object"){m=0;for(o in n){m++}return m}},remove:function(m){var n;e.updateData(this);e.filterName(m);n=this._data;if(typeof n==="object"&&n[m]!==undefined){delete n[m];e.setData(this)}return this},clear:function(){e.updateData(this);if(typeof this._data==="object"){this._data={};e.setData(this)}return this},setMaxAge:function(m){m=e.fixMaxAge(m);if(m!==undefined){e.updateData(this);if(this._info){this._info.a=m;e.setInfo(this)}}},getMaxAge:function(){e.updateData(this);if(this._info){return this._info.a}}};if(c.type!=="none"){a=/cs_cStorage_=1/;if(!a.test(j.cookie)){j.cookie="cs_cStorage_=1;path=/";c._firstLoad=true}}else{c.support=false;c.use=function(){return c._tool.initObj({})}}})(window);(function(f){var c=f.cStorage,b,g,a,e;if(c.type!=="storage"){return}b=c._tool;g=b.storage;a={};e="i";c.use=function(j,h){var i=b.getStorageName(j),k;if(a[i]){return a[i]}if(b.createCallBack){b.createCallBack(j)}k=b.getItem(i+e);if(k){a[i]=new d(i,undefined,false);return a[i]}a[i]=new d(i,b.fixMaxAge(h),true);return a[i]};c.exists=function(h){return !!this.info(h)};c.info=function(i){var h=b.getStorageName(i),j=b.getItem(h+e);if(j){return j}return null};c.destroy=function(i){var h=b.getStorageName(i),j=a[h];g.removeItem(h);g.removeItem(h+e);if(j){b.initObj(j);delete a[h]}};function d(j,h,i){var k=new Date().getTime();this._storageName=j;if(i){this._data={};this._info={d:k,a:h===undefined?b.dA:h};b.setData(this)}else{this._data=b.getItem(j)||{};this._info=b.getItem(j+e);this._info.d=k;b.setInfo(this)}}d.prototype=c._publicMethods;b.setData=function(i){try{g.setItem(i._storageName,this.stringifyJSON(i._data))}catch(h){}i._info.s=this.random();this.setInfo(i)};b.setInfo=function(h){g.setItem(h._storageName+e,this.stringifyJSON(h._info))};b.updateData=function(k){var i=k._storageName,j=k._info,h=b.getItem(i+e);if(!h){k._data=k._info=undefined}else{if(!j||j.s!==h.s){k._data=b.getItem(i)||{};k._info=h}}};b.getItem=function(i){var h;try{h=this.parseJSON(g.getItem(i))}catch(j){}return h}})(window);(function(c){var b,h,g,d,a,i,e,f;if(!c.support){return}g=c._tool;b=g.useManager("_cStorageCookieManager",90);d=b._data;if(c._firstLoad){c.destroy("_cStorageSessionManager");e=new Date().getTime();for(a in d){i=g.parseJSON(d[a]);if(i&&i[1]&&i[1]<e){delete d[a]}}g.setData(b)}h=g.useManager("_cStorageSessionManager",90);f=function(j){b.remove(j);h.remove(j)};c.cookie={set:function(l,n,j){var m,k;g.filterName(l);if(n===undefined){f(l);return this}if(j===undefined){b.remove(l);h.set(l,n);return this}m=g.coreToString.call(j).slice(8,-1);k=new Date().getTime();if(m==="Number"){if(j<=0){f(l)}else{h.remove(l);b.set(l,[n,k+j])}}else{if(m==="Date"){j=j.getTime();if(j<=k){f(l)}else{h.remove(l);b.set(l,[n,j])}}else{g.error("\u53C2\u6570expires\u9519\u8BEF")}}return this},get:function(j){var k;g.filterName(j);k=b.get(j);if(k){if(k[1]&&k[1]<new Date().getTime()){b.remove(j);return}return k[0]}else{return h.get(j)}},remove:function(j){g.filterName(j);f(j);return this}}})(window.cStorage);(function(g){var c=g.cStorage,b,a,d,h,f,e;if(!c.support){return}if(c._firstLoad){d=c._tool.useManager("_cStorageCreateManager");h=d.get("nameList");b=new Date().getTime();if(typeof h==="object"){for(f in h){e=c.info(f);if(!e||e.a===0||b>e.d+e.a*86400000){c.destroy(f);delete h[f]}}d.set("nameList",h)}else{if(c.type==="storage"){a=g.localStorage;for(f in a){f=/^cs_(\w{8,})_$/.exec(f);if(f){f=f[1];e=c.info(f);if(!e||e.a===0||b>e.d+e.a*86400000){c.destroy(f)}}}}}}})(window);(function(c){var a=c.cStorage,b,d;if(!a.support){return}b=a._tool.useManager("_cStorageCreateManager",90);a._tool.createCallBack=function(e){d=b.get("nameList")||{};if(!d[e]){d[e]=1;b.set("nameList",d)}}})(window);